---

title: Iterate over classifiers with Bayesian optimization


keywords: fastai
sidebar: home_sidebar



nb_path: "04_model_zoo.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_model_zoo.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_data</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Synthetic binary classification dataset.&quot;&quot;&quot;</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">n_features</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span>


<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_compile_results</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">))</span> <span class="c1"># &#39;./bayes_opt_logs/&#39; works fine as well.</span>
    <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Iterate-models">Iterate models<a class="anchor-link" href="#Iterate-models"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelIterator" class="doc_header"><code>class</code> <code>ModelIterator</code><a href="https://github.com/DavidykZhao/Yikai_helper_funcs/tree/master/Yikai_helper_funcs/model_iterator.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelIterator</code>(<strong><code>x</code></strong>, <strong><code>y</code></strong>, <strong><code>rf_params</code></strong>=<em><code>None</code></em>, <strong><code>xgboost_params</code></strong>=<em><code>None</code></em>, <strong><code>lightgbm_params</code></strong>=<em><code>None</code></em>, <strong><code>log_path</code></strong>=<em><code>Path('bayes_opt_logs')</code></em>, <strong><code>rf_init_points</code></strong>=<em><code>10</code></em>, <strong><code>rf_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>xgboost_init_points</code></strong>=<em><code>10</code></em>, <strong><code>xgboost_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>lightgbm_init_points</code></strong>=<em><code>10</code></em>, <strong><code>lightgbm_n_iter</code></strong>=<em><code>5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="n">ModelIterator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The best combination of hyperparameters are {&#39;ccp_alpha&#39;: 0.1, &#39;max_depth&#39;: 70.57988694377921, &#39;min_samples_split&#39;: 2.0, &#39;n_estimators&#39;: 20.0}
The best score for the hyperparameters are 0.85
The best combination of hyperparameters are {&#39;gamma&#39;: 3.7136776609260598, &#39;learning_rate&#39;: 0.2167961016370373, &#39;max_depth&#39;: 7.539356769634978, &#39;min_child_weight&#39;: 0.5068658104168189, &#39;n_estimators&#39;: 33.88882170271247, &#39;subsample&#39;: 0.6212943010806828}
The best score for the hyperparameters are 0.8300000000000001

        ----------------------------------------------------
        Returned best_rf, best_xgboost
        
        
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RandomForestClassifier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span><span class="o">.</span><span class="n">compile_results</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>params</th>
      <th>datetime</th>
      <th>model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14</th>
      <td>0.85</td>
      <td>{'ccp_alpha': 0.1, 'max_depth': 70.57988694377921, 'min_samples_split': 2.0, 'n_estimators': 20.0}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 11.703147, 'delta': 0.25911}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.84</td>
      <td>{'ccp_alpha': 0.054105622366733004, 'max_depth': 57.048673161898094, 'min_samples_split': 48.10446300913914, 'n_estimators': 279.32115719676585}</td>
      <td>{'datetime': '2020-10-30 11:19:01', 'elapsed': 9.090092, 'delta': 1.138335}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.83</td>
      <td>{'gamma': 3.7136776609260593, 'learning_rate': 0.21679610163703703, 'max_depth': 7.539356769634978, 'min_child_weight': 0.506865810416818, 'n_estimators': 33.88882170271247, 'subsample': 0.6212943010806821}</td>
      <td>{'datetime': '2020-10-30 11:19:05', 'elapsed': 1.236437, 'delta': 0.280117}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.83</td>
      <td>{'ccp_alpha': 0.034467543507090005, 'max_depth': 58.94063876431647, 'min_samples_split': 46.35661028585887, 'n_estimators': 282.45330643881437}</td>
      <td>{'datetime': '2020-10-30 11:19:00', 'elapsed': 7.730209, 'delta': 1.025486}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.83</td>
      <td>{'ccp_alpha': 0.052129562762187005, 'max_depth': 105.0, 'min_samples_split': 2.0, 'n_estimators': 111.6100155243519}</td>
      <td>{'datetime': '2020-10-30 11:19:03', 'elapsed': 11.444037, 'delta': 0.6602800000000001}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.82</td>
      <td>{'ccp_alpha': 0.079444386496789, 'max_depth': 89.81701419845686, 'min_samples_split': 40.04511099725938, 'n_estimators': 107.83760330551017}</td>
      <td>{'datetime': '2020-10-30 11:18:56', 'elapsed': 3.904091, 'delta': 0.485176}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.82</td>
      <td>{'ccp_alpha': 0.090688706631161, 'max_depth': 81.67031636664547, 'min_samples_split': 30.579345722625956, 'n_estimators': 79.8789446662902}</td>
      <td>{'datetime': '2020-10-30 11:19:01', 'elapsed': 9.620502, 'delta': 0.53041}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.81</td>
      <td>{'gamma': 9.477275494910353, 'learning_rate': 0.15320101738702502, 'max_depth': 4.863992233552129, 'min_child_weight': 0.40526383582332304, 'n_estimators': 11.0840109699008, 'subsample': 0.469092172621336}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.12967099999999998, 'delta': 0.032591999999999996}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.81</td>
      <td>{'gamma': 11.682946644747425, 'learning_rate': 0.285787689887124, 'max_depth': 5.964892778826315, 'min_child_weight': 0.59792575807783, 'n_estimators': 7.273720969528306, 'subsample': 0.491952710919951}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.37557799999999997, 'delta': 0.022227}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.81</td>
      <td>{'gamma': 2.356996174242245, 'learning_rate': 0.285225525983594, 'max_depth': 9.521255624586537, 'min_child_weight': 0.550847343570219, 'n_estimators': 39.682297752391584, 'subsample': 0.7604369695630081}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.301013, 'delta': 0.07479000000000001}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.81</td>
      <td>{'ccp_alpha': 0.1, 'max_depth': 26.96924106885043, 'min_samples_split': 24.29917476437925, 'n_estimators': 275.50628409830614}</td>
      <td>{'datetime': '2020-10-30 11:19:03', 'elapsed': 10.783757, 'delta': 1.163255}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0.80</td>
      <td>{'gamma': 1.297114520132526, 'learning_rate': 0.30000000000000004, 'max_depth': 11.248655000452295, 'min_child_weight': 0.49265157496704903, 'n_estimators': 35.0205603432154, 'subsample': 1.0}</td>
      <td>{'datetime': '2020-10-30 11:19:06', 'elapsed': 1.885975, 'delta': 0.32606799999999997}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0.80</td>
      <td>{'gamma': 13.874336311182162, 'learning_rate': 0.040798407426328, 'max_depth': 3.353291280226819, 'min_child_weight': 0.435382675551775, 'n_estimators': 10.60214113018423, 'subsample': 0.84769380597534}</td>
      <td>{'datetime': '2020-10-30 11:19:05', 'elapsed': 0.9563200000000001, 'delta': 0.201185}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.77</td>
      <td>{'ccp_alpha': 0.077707582097553, 'max_depth': 60.22990167177655, 'min_samples_split': 53.63359351604443, 'n_estimators': 51.733666590068665}</td>
      <td>{'datetime': '2020-10-30 11:19:00', 'elapsed': 7.951757, 'delta': 0.221548}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.77</td>
      <td>{'gamma': 21.55740142042905, 'learning_rate': 0.101977121725855, 'max_depth': 3.978659459220488, 'min_child_weight': 0.325530255175772, 'n_estimators': 80.5074064527926, 'subsample': 0.799788180723332}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.48838499999999996, 'delta': 0.11280699999999999}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.77</td>
      <td>{'gamma': 17.202266038843767, 'learning_rate': 0.206853344082878, 'max_depth': 4.965050363164218, 'min_child_weight': 0.010897160447346, 'n_estimators': 98.78563930497573, 'subsample': 0.352041108796505}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.74</td>
      <td>{'gamma': 8.472591328325233, 'learning_rate': 0.024749620932187, 'max_depth': 3.014940120467107, 'min_child_weight': 0.36660537494814105, 'n_estimators': 18.59270819873384, 'subsample': 0.16399799364290601}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.35335099999999997, 'delta': 0.025157}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.64</td>
      <td>{'gamma': 25.81292137831208, 'learning_rate': 0.006853702016009, 'max_depth': 11.259229751956875, 'min_child_weight': 0.047755943163437, 'n_estimators': 30.256405315545983, 'subsample': 0.611960393177389}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.194134, 'delta': 0.06446299999999999}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.51</td>
      <td>{'ccp_alpha': 0.071814971293265, 'max_depth': 59.28555582716882, 'min_samples_split': 69.81764210434378, 'n_estimators': 208.86781077038265}</td>
      <td>{'datetime': '2020-10-30 11:18:53', 'elapsed': 0.7310289999999999, 'delta': 0.7310289999999999}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.51</td>
      <td>{'gamma': 35.71438254480323, 'learning_rate': 0.15027518516065502, 'max_depth': 9.533453258275344, 'min_child_weight': 0.291666390115639, 'n_estimators': 36.84389415862644, 'subsample': 0.070927628181147}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.22622299999999998, 'delta': 0.032089}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.51</td>
      <td>{'gamma': 5.302601752058265, 'learning_rate': 0.30000000000000004, 'max_depth': 11.005190062080425, 'min_child_weight': 0.6000000000000001, 'n_estimators': 7.801669872531392, 'subsample': 0.05}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.755135, 'delta': 0.26675000000000004}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.51</td>
      <td>{'ccp_alpha': 0.08446897310419901, 'max_depth': 34.821744125910946, 'min_samples_split': 63.649295906671355, 'n_estimators': 450.71865004210423}</td>
      <td>{'datetime': '2020-10-30 11:18:55', 'elapsed': 3.418915, 'delta': 1.587453}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.51</td>
      <td>{'ccp_alpha': 0.063135926347461, 'max_depth': 76.67345782686017, 'min_samples_split': 89.10273404381282, 'n_estimators': 314.46516352351586}</td>
      <td>{'datetime': '2020-10-30 11:18:54', 'elapsed': 1.831462, 'delta': 1.100433}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0.51</td>
      <td>{'gamma': 6.591214432577629, 'learning_rate': 0.117891304483605, 'max_depth': 3.0, 'min_child_weight': 0.5872939320503411, 'n_estimators': 38.66136614723358, 'subsample': 0.072672145551595}</td>
      <td>{'datetime': '2020-10-30 11:19:05', 'elapsed': 1.559907, 'delta': 0.32347000000000004}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.49</td>
      <td>{'gamma': 27.887744884046047, 'learning_rate': 0.072749340794139, 'max_depth': 3.1941346181378982, 'min_child_weight': 0.38874198728144504, 'n_estimators': 86.36112615476337, 'subsample': 0.32927399832055104}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.097079, 'delta': 0.097079}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.49</td>
      <td>{'ccp_alpha': 0.055141083724336, 'max_depth': 32.00995086307076, 'min_samples_split': 68.92343673535113, 'n_estimators': 98.70806862911428}</td>
      <td>{'datetime': '2020-10-30 11:18:59', 'elapsed': 6.7047229999999995, 'delta': 0.513694}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.49</td>
      <td>{'gamma': 28.723606125798447, 'learning_rate': 0.15047426039129302, 'max_depth': 8.867453813181323, 'min_child_weight': 0.33680919478033905, 'n_estimators': 18.481715022920927, 'subsample': 0.20846854975380902}</td>
      <td>{'datetime': '2020-10-30 11:19:04', 'elapsed': 0.328194, 'delta': 0.027181}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.49</td>
      <td>{'ccp_alpha': 0.08847292157087801, 'max_depth': 102.27944171121572, 'min_samples_split': 96.5222973234869, 'n_estimators': 162.2319364733051}</td>
      <td>{'datetime': '2020-10-30 11:18:58', 'elapsed': 6.191029, 'delta': 0.833235}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.49</td>
      <td>{'ccp_alpha': 0.098043186554783, 'max_depth': 55.5590497396573, 'min_samples_split': 81.51069057419906, 'n_estimators': 403.6132176350584}</td>
      <td>{'datetime': '2020-10-30 11:18:57', 'elapsed': 5.357794, 'delta': 1.453703}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.49</td>
      <td>{'ccp_alpha': 0.033998223396786, 'max_depth': 90.4955314624154, 'min_samples_split': 93.35230721483705, 'n_estimators': 77.64979848292961}</td>
      <td>{'datetime': '2020-10-30 11:18:52', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>forest</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;bootstrap&#39;: True,
 &#39;ccp_alpha&#39;: 0.1,
 &#39;class_weight&#39;: None,
 &#39;criterion&#39;: &#39;gini&#39;,
 &#39;max_depth&#39;: 70,
 &#39;max_features&#39;: &#39;auto&#39;,
 &#39;max_leaf_nodes&#39;: None,
 &#39;max_samples&#39;: None,
 &#39;min_impurity_decrease&#39;: 0.0,
 &#39;min_impurity_split&#39;: None,
 &#39;min_samples_leaf&#39;: 1,
 &#39;min_samples_split&#39;: 2,
 &#39;min_weight_fraction_leaf&#39;: 0.0,
 &#39;n_estimators&#39;: 20,
 &#39;n_jobs&#39;: -1,
 &#39;oob_score&#39;: False,
 &#39;random_state&#39;: None,
 &#39;verbose&#39;: 0,
 &#39;warm_start&#39;: False}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

