---

title: Iterate over classifiers with Bayesian optimization


keywords: fastai
sidebar: home_sidebar



nb_path: "04_model_zoo.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_model_zoo.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_data</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Synthetic binary classification dataset.&quot;&quot;&quot;</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">n_features</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span>


<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_compile_results</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">))</span> <span class="c1"># &#39;./bayes_opt_logs/&#39; works fine as well.</span>
    <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Iterate-models">Iterate models<a class="anchor-link" href="#Iterate-models"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelIterator" class="doc_header"><code>class</code> <code>ModelIterator</code><a href="https://github.com/DavidykZhao/Yikai_helper_funcs/tree/master/Yikai_helper_funcs/model_iterator.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelIterator</code>(<strong><code>x</code></strong>, <strong><code>y</code></strong>, <strong><code>rf_params</code></strong>=<em><code>None</code></em>, <strong><code>xgboost_params</code></strong>=<em><code>None</code></em>, <strong><code>lightgbm_params</code></strong>=<em><code>None</code></em>, <strong><code>log_path</code></strong>=<em><code>Path('bayes_opt_logs')</code></em>, <strong><code>rf_init_points</code></strong>=<em><code>10</code></em>, <strong><code>rf_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>xgboost_init_points</code></strong>=<em><code>10</code></em>, <strong><code>xgboost_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>lightgbm_init_points</code></strong>=<em><code>10</code></em>, <strong><code>lightgbm_n_iter</code></strong>=<em><code>5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="n">ModelIterator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The best combination of hyperparameters are {&#39;ccp_alpha&#39;: 0.08830026526241672, &#39;max_depth&#39;: 100.19386157870402, &#39;min_samples_split&#39;: 40.341341327020295, &#39;n_estimators&#39;: 350.0713846235119}
The best score for the hyperparameters are 0.93
The best combination of hyperparameters are {&#39;gamma&#39;: 32.98401068803757, &#39;learning_rate&#39;: 0.04145004574335963, &#39;max_depth&#39;: 6.416662902313407, &#39;min_child_weight&#39;: 0.300129784066568, &#39;n_estimators&#39;: 18.071373415937323, &#39;subsample&#39;: 0.8980155925879995}
The best score for the hyperparameters are 0.9099999999999999

        ----------------------------------------------------
        Returned best_rf, best_xgboost
        
        
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RandomForestClassifier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span><span class="o">.</span><span class="n">compile_results</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>params</th>
      <th>datetime</th>
      <th>model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>0.92</td>
      <td>{'ccp_alpha': 0.067279368242635, 'max_depth': 91.03474087288205, 'min_samples_split': 26.240855559576847, 'n_estimators': 430.02833821659726}</td>
      <td>{'datetime': '2020-10-30 11:36:40', 'elapsed': 6.50518, 'delta': 1.469874}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.92</td>
      <td>{'ccp_alpha': 0.07100718803377201, 'max_depth': 48.415180987244405, 'min_samples_split': 23.245071908137618, 'n_estimators': 222.12516088441248}</td>
      <td>{'datetime': '2020-10-30 11:36:42', 'elapsed': 7.872465, 'delta': 0.8809300000000001}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0.91</td>
      <td>{'gamma': 23.471406303633138, 'learning_rate': 0.30000000000000004, 'max_depth': 6.496415610335795, 'min_child_weight': 0.6000000000000001, 'n_estimators': 69.8177992230171, 'subsample': 1.0}</td>
      <td>{'datetime': '2020-10-30 11:37:30', 'elapsed': 2.38872, 'delta': 0.498231}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0.91</td>
      <td>{'gamma': 26.684037893019685, 'learning_rate': 0.30000000000000004, 'max_depth': 10.089188228688416, 'min_child_weight': 0.6000000000000001, 'n_estimators': 67.6191739478623, 'subsample': 1.0}</td>
      <td>{'datetime': '2020-10-30 11:37:30', 'elapsed': 1.890489, 'delta': 0.33347899999999997}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.91</td>
      <td>{'gamma': 25.03612198995891, 'learning_rate': 0.30000000000000004, 'max_depth': 6.6950519570567195, 'min_child_weight': 0.6000000000000001, 'n_estimators': 64.7335622168152, 'subsample': 1.0}</td>
      <td>{'datetime': '2020-10-30 11:37:30', 'elapsed': 1.55701, 'delta': 0.385665}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.91</td>
      <td>{'gamma': 27.311304164918727, 'learning_rate': 0.17494967328494102, 'max_depth': 3.792886316623781, 'min_child_weight': 0.511493892786127, 'n_estimators': 68.24213228044414, 'subsample': 0.9711859231425151}</td>
      <td>{'datetime': '2020-10-30 11:37:29', 'elapsed': 0.570624, 'delta': 0.098658}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.91</td>
      <td>{'ccp_alpha': 0.051249200760959006, 'max_depth': 90.2344518151939, 'min_samples_split': 6.47177794834542, 'n_estimators': 161.11245121507758}</td>
      <td>{'datetime': '2020-10-30 11:36:37', 'elapsed': 3.643096, 'delta': 0.616495}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.91</td>
      <td>{'gamma': 29.907283188432896, 'learning_rate': 0.22936197296285502, 'max_depth': 4.936189462050605, 'min_child_weight': 0.585635681443024, 'n_estimators': 90.27879421089291, 'subsample': 0.9730594600408781}</td>
      <td>{'datetime': '2020-10-30 11:37:28', 'elapsed': 0.37666000000000005, 'delta': 0.144502}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.91</td>
      <td>{'gamma': 21.597278566095166, 'learning_rate': 0.155399005398684, 'max_depth': 3.3453028355846213, 'min_child_weight': 0.36001909276979904, 'n_estimators': 10.781942173643085, 'subsample': 0.803301864300732}</td>
      <td>{'datetime': '2020-10-30 11:37:28', 'elapsed': 0.026674, 'delta': 0.026674}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.90</td>
      <td>{'ccp_alpha': 0.09985531011958401, 'max_depth': 66.98699990325483, 'min_samples_split': 2.0, 'n_estimators': 391.71719157229995}</td>
      <td>{'datetime': '2020-10-30 11:36:45', 'elapsed': 10.833482, 'delta': 1.6076329999999999}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.90</td>
      <td>{'gamma': 5.365620577425313, 'learning_rate': 0.010486829902519, 'max_depth': 3.9152371297170303, 'min_child_weight': 0.46856138291307303, 'n_estimators': 83.58061333688336, 'subsample': 0.43655178132756106}</td>
      <td>{'datetime': '2020-10-30 11:37:28', 'elapsed': 0.471966, 'delta': 0.095306}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.90</td>
      <td>{'gamma': 4.475748433081123, 'learning_rate': 0.289110353293002, 'max_depth': 4.540449330988248, 'min_child_weight': 0.158540151910118, 'n_estimators': 65.65854553297795, 'subsample': 0.632591860313326}</td>
      <td>{'datetime': '2020-10-30 11:37:28', 'elapsed': 0.12698099999999998, 'delta': 0.100307}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.90</td>
      <td>{'ccp_alpha': 0.09618125652521001, 'max_depth': 61.08996911109283, 'min_samples_split': 5.21092742593978, 'n_estimators': 206.12720949857385}</td>
      <td>{'datetime': '2020-10-30 11:36:34', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.90</td>
      <td>{'ccp_alpha': 0.086604590966162, 'max_depth': 49.484625276614, 'min_samples_split': 24.393876818822147, 'n_estimators': 223.8343877755006}</td>
      <td>{'datetime': '2020-10-30 11:36:36', 'elapsed': 2.14823, 'delta': 0.839047}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.90</td>
      <td>{'ccp_alpha': 0.091617303157733, 'max_depth': 92.13880367542795, 'min_samples_split': 23.33468467250806, 'n_estimators': 85.73520917172775}</td>
      <td>{'datetime': '2020-10-30 11:36:37', 'elapsed': 3.026601, 'delta': 0.340362}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0.89</td>
      <td>{'gamma': 6.657311159502244, 'learning_rate': 0.27574681526677103, 'max_depth': 6.190332127664505, 'min_child_weight': 0.11562958249880101, 'n_estimators': 70.03974771118654, 'subsample': 0.48607006467532904}</td>
      <td>{'datetime': '2020-10-30 11:37:29', 'elapsed': 1.171345, 'delta': 0.391582}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.89</td>
      <td>{'gamma': 9.65462615809409, 'learning_rate': 0.282951525754122, 'max_depth': 7.845212052396139, 'min_child_weight': 0.024555287845468003, 'n_estimators': 74.62573910337052, 'subsample': 0.31947177034317603}</td>
      <td>{'datetime': '2020-10-30 11:37:28', 'elapsed': 0.201461, 'delta': 0.07448}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.89</td>
      <td>{'gamma': 28.19158857295412, 'learning_rate': 0.13735716372828602, 'max_depth': 4.695676215555062, 'min_child_weight': 0.189407919750186, 'n_estimators': 67.61913170509787, 'subsample': 0.6490783386343171}</td>
      <td>{'datetime': '2020-10-30 11:37:29', 'elapsed': 0.779763, 'delta': 0.124705}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.01, 'max_depth': 20.0, 'min_samples_split': 12.146941007698247, 'n_estimators': 192.85147903031628}</td>
      <td>{'datetime': '2020-10-30 11:36:43', 'elapsed': 8.760075, 'delta': 0.8876100000000001}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.88</td>
      <td>{'ccp_alpha': 0.1, 'max_depth': 42.81889957630193, 'min_samples_split': 8.361855815201398, 'n_estimators': 74.0476712816246}</td>
      <td>{'datetime': '2020-10-30 11:36:43', 'elapsed': 9.225849, 'delta': 0.46577399999999997}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.88</td>
      <td>{'ccp_alpha': 0.086581213471507, 'max_depth': 70.42589233505448, 'min_samples_split': 44.070515534640336, 'n_estimators': 351.0797773071582}</td>
      <td>{'datetime': '2020-10-30 11:36:35', 'elapsed': 1.309183, 'delta': 1.309183}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.88</td>
      <td>{'gamma': 28.05142600015543, 'learning_rate': 0.132150452774288, 'max_depth': 11.389215008870234, 'min_child_weight': 0.517914274862028, 'n_estimators': 51.212638041378476, 'subsample': 0.47118235283652005}</td>
      <td>{'datetime': '2020-10-30 11:37:29', 'elapsed': 0.632872, 'delta': 0.062248}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.88</td>
      <td>{'gamma': 15.986553553770474, 'learning_rate': 0.20860608539091102, 'max_depth': 9.800468308617411, 'min_child_weight': 0.460010854180655, 'n_estimators': 10.795039846669322, 'subsample': 0.28527256857417205}</td>
      <td>{'datetime': '2020-10-30 11:37:29', 'elapsed': 0.6550579999999999, 'delta': 0.022185999999999997}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.85</td>
      <td>{'ccp_alpha': 0.08036747162707, 'max_depth': 39.53153893913178, 'min_samples_split': 53.289888968835996, 'n_estimators': 103.92341219365113}</td>
      <td>{'datetime': '2020-10-30 11:36:41', 'elapsed': 6.991535, 'delta': 0.486355}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.78</td>
      <td>{'ccp_alpha': 0.1, 'max_depth': 51.9964211326799, 'min_samples_split': 55.69450738199383, 'n_estimators': 408.90741205395057}</td>
      <td>{'datetime': '2020-10-30 11:36:46', 'elapsed': 12.439134, 'delta': 1.605652}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.50</td>
      <td>{'ccp_alpha': 0.030780761219811003, 'max_depth': 67.62944564439553, 'min_samples_split': 63.65984721232478, 'n_estimators': 131.49333328182905}</td>
      <td>{'datetime': '2020-10-30 11:36:37', 'elapsed': 2.686239, 'delta': 0.538009}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.50</td>
      <td>{'ccp_alpha': 0.018863501294665002, 'max_depth': 93.4608196817206, 'min_samples_split': 80.59583362441445, 'n_estimators': 116.4075050314298}</td>
      <td>{'datetime': '2020-10-30 11:36:38', 'elapsed': 4.104478, 'delta': 0.46138199999999996}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.50</td>
      <td>{'ccp_alpha': 0.06575421706737801, 'max_depth': 49.71766103421805, 'min_samples_split': 78.08726002355733, 'n_estimators': 271.9336623177094}</td>
      <td>{'datetime': '2020-10-30 11:36:39', 'elapsed': 5.035306, 'delta': 0.930828}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.50</td>
      <td>{'gamma': 39.935878552782476, 'learning_rate': 0.1754922686227, 'max_depth': 9.081110196661328, 'min_child_weight': 0.029048756531812003, 'n_estimators': 26.182793779434512, 'subsample': 0.266547284912096}</td>
      <td>{'datetime': '2020-10-30 11:37:28', 'elapsed': 0.232158, 'delta': 0.030697}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.50</td>
      <td>{'gamma': 29.787459068800004, 'learning_rate': 0.070520812724949, 'max_depth': 5.799492866833579, 'min_child_weight': 0.5738455611274651, 'n_estimators': 36.825644774178656, 'subsample': 0.073401749896599}</td>
      <td>{'datetime': '2020-10-30 11:37:28', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>xgboost</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;bootstrap&#39;: True,
 &#39;ccp_alpha&#39;: 0.08830026526241672,
 &#39;class_weight&#39;: None,
 &#39;criterion&#39;: &#39;gini&#39;,
 &#39;max_depth&#39;: 100,
 &#39;max_features&#39;: &#39;auto&#39;,
 &#39;max_leaf_nodes&#39;: None,
 &#39;max_samples&#39;: None,
 &#39;min_impurity_decrease&#39;: 0.0,
 &#39;min_impurity_split&#39;: None,
 &#39;min_samples_leaf&#39;: 1,
 &#39;min_samples_split&#39;: 40,
 &#39;min_weight_fraction_leaf&#39;: 0.0,
 &#39;n_estimators&#39;: 350,
 &#39;n_jobs&#39;: -1,
 &#39;oob_score&#39;: False,
 &#39;random_state&#39;: None,
 &#39;verbose&#39;: 0,
 &#39;warm_start&#39;: False}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

