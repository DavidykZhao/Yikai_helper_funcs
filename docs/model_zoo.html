---

title: Iterate over classifiers with Bayesian optimization


keywords: fastai
sidebar: home_sidebar



nb_path: "04_model_zoo.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_model_zoo.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_data</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Synthetic binary classification dataset.&quot;&quot;&quot;</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">n_features</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span>


<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_compile_results</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">))</span> <span class="c1"># &#39;./bayes_opt_logs/&#39; works fine as well.</span>
    <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Iterate-models">Iterate models<a class="anchor-link" href="#Iterate-models"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelIterator" class="doc_header"><code>class</code> <code>ModelIterator</code><a href="https://github.com/DavidykZhao/Yikai_helper_funcs/tree/master/Yikai_helper_funcs/model_iterator.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelIterator</code>(<strong><code>x</code></strong>, <strong><code>y</code></strong>, <strong><code>rf_params</code></strong>=<em><code>None</code></em>, <strong><code>xgboost_params</code></strong>=<em><code>None</code></em>, <strong><code>lightgbm_params</code></strong>=<em><code>None</code></em>, <strong><code>log_path</code></strong>=<em><code>Path('bayes_opt_logs')</code></em>, <strong><code>rf_init_points</code></strong>=<em><code>10</code></em>, <strong><code>rf_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>xgboost_init_points</code></strong>=<em><code>10</code></em>, <strong><code>xgboost_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>lightgbm_init_points</code></strong>=<em><code>10</code></em>, <strong><code>lightgbm_n_iter</code></strong>=<em><code>5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="n">ModelIterator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The best combination of hyperparameters are {&#39;ccp_alpha&#39;: 0.016125949599018908, &#39;max_depth&#39;: 85.2182034515113, &#39;min_samples_split&#39;: 30.20533749120456, &#39;n_estimators&#39;: 116.38316525005445}
The best score for the hyperparameters are 0.9
The best combination of hyperparameters are {&#39;gamma&#39;: 19.44714671178108, &#39;learning_rate&#39;: 0.25218693542334614, &#39;max_depth&#39;: 5.56688841657944, &#39;min_child_weight&#39;: 0.49835854789956996, &#39;n_estimators&#39;: 57.528298183122644, &#39;subsample&#39;: 0.5058840564323542}
The best score for the hyperparameters are 0.9

        ----------------------------------------------------
        Returned best_rf, best_xgboost
        
        
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RandomForestClassifier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span><span class="o">.</span><span class="n">compile_results</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>params</th>
      <th>datetime</th>
      <th>model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>22</th>
      <td>0.90</td>
      <td>{'gamma': 19.44714671178108, 'learning_rate': 0.252186935423346, 'max_depth': 5.56688841657944, 'min_child_weight': 0.498358547899569, 'n_estimators': 57.528298183122644, 'subsample': 0.505884056432354}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.570715, 'delta': 0.06661}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.90</td>
      <td>{'ccp_alpha': 0.016125949599018002, 'max_depth': 85.2182034515113, 'min_samples_split': 30.20533749120456, 'n_estimators': 116.38316525005445}</td>
      <td>{'datetime': '2020-10-30 13:39:14', 'elapsed': 6.618534, 'delta': 0.490751}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.89</td>
      <td>{'gamma': 18.737012674306975, 'learning_rate': 0.014042230087081001, 'max_depth': 7.598830144613695, 'min_child_weight': 0.029469544819655004, 'n_estimators': 17.20045943691692, 'subsample': 0.46396463518934905}</td>
      <td>{'datetime': '2020-10-30 13:39:23', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.07057335618820701, 'max_depth': 94.35201054110658, 'min_samples_split': 19.5976583373162, 'n_estimators': 339.8544431378984}</td>
      <td>{'datetime': '2020-10-30 13:39:20', 'elapsed': 11.903299, 'delta': 1.3172220000000001}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.89</td>
      <td>{'gamma': 24.8022125052445, 'learning_rate': 0.257794332839592, 'max_depth': 7.673275585234246, 'min_child_weight': 0.549623218287408, 'n_estimators': 16.218405446276055, 'subsample': 0.690499024759992}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.504105, 'delta': 0.030532999999999998}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.89</td>
      <td>{'gamma': 21.439396566414764, 'learning_rate': 0.020335018280972002, 'max_depth': 8.919223833338647, 'min_child_weight': 0.34887411942114405, 'n_estimators': 90.41754215173228, 'subsample': 0.810918861932405}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.440835, 'delta': 0.135839}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.07443589926857101, 'max_depth': 102.81105604300114, 'min_samples_split': 45.34188427654193, 'n_estimators': 327.32490352685704}</td>
      <td>{'datetime': '2020-10-30 13:39:09', 'elapsed': 1.07041, 'delta': 1.07041}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.014363318727668, 'max_depth': 43.052297264116355, 'min_samples_split': 10.089210650567475, 'n_estimators': 278.34654944365667}</td>
      <td>{'datetime': '2020-10-30 13:39:23', 'elapsed': 15.324774, 'delta': 1.079825}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.024827837855866, 'max_depth': 99.93259289398, 'min_samples_split': 16.52783778237177, 'n_estimators': 309.11254588276654}</td>
      <td>{'datetime': '2020-10-30 13:39:22', 'elapsed': 14.244949, 'delta': 1.188328}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.1, 'max_depth': 65.0302536147975, 'min_samples_split': 7.550138093644308, 'n_estimators': 317.9106478932843}</td>
      <td>{'datetime': '2020-10-30 13:39:21', 'elapsed': 13.056621, 'delta': 1.153322}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0.89</td>
      <td>{'gamma': 11.595153208899665, 'learning_rate': 0.30000000000000004, 'max_depth': 3.0, 'min_child_weight': 0.32568087316030503, 'n_estimators': 97.96879364031851, 'subsample': 0.8650746855103251}</td>
      <td>{'datetime': '2020-10-30 13:39:26', 'elapsed': 2.266369, 'delta': 0.324785}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.037188748842555006, 'max_depth': 21.244408962722567, 'min_samples_split': 11.295387099572558, 'n_estimators': 311.0303530972091}</td>
      <td>{'datetime': '2020-10-30 13:39:13', 'elapsed': 5.16706, 'delta': 1.047601}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.08743445975771201, 'max_depth': 94.53176717632547, 'min_samples_split': 22.54905134007344, 'n_estimators': 473.9440303474636}</td>
      <td>{'datetime': '2020-10-30 13:39:17', 'elapsed': 9.344796, 'delta': 1.521343}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.098140913656444, 'max_depth': 73.0573060604967, 'min_samples_split': 32.77733513441176, 'n_estimators': 335.30490645573144}</td>
      <td>{'datetime': '2020-10-30 13:39:10', 'elapsed': 2.19438, 'delta': 1.12397}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.88</td>
      <td>{'ccp_alpha': 0.020765056359892002, 'max_depth': 104.3578111183841, 'min_samples_split': 46.439277699373235, 'n_estimators': 327.76137184563254}</td>
      <td>{'datetime': '2020-10-30 13:39:18', 'elapsed': 10.586077, 'delta': 1.241281}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0.88</td>
      <td>{'gamma': 20.728145669559044, 'learning_rate': 0.30000000000000004, 'max_depth': 5.251513983012976, 'min_child_weight': 0.6000000000000001, 'n_estimators': 5.842275473748512, 'subsample': 1.0}</td>
      <td>{'datetime': '2020-10-30 13:39:25', 'elapsed': 1.274283, 'delta': 0.252165}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.88</td>
      <td>{'gamma': 17.5607249446919, 'learning_rate': 0.24246749199720102, 'max_depth': 7.534944716103667, 'min_child_weight': 0.17784117491842102, 'n_estimators': 76.94994709477186, 'subsample': 0.524747422598398}</td>
      <td>{'datetime': '2020-10-30 13:39:23', 'elapsed': 0.133413, 'delta': 0.133413}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.88</td>
      <td>{'gamma': 31.35981412832438, 'learning_rate': 0.008504255229120001, 'max_depth': 8.646643049199104, 'min_child_weight': 0.290289370337108, 'n_estimators': 8.455706268795588, 'subsample': 0.9696518032825341}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.304996, 'delta': 0.022702}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0.88</td>
      <td>{'gamma': 31.795513273405945, 'learning_rate': 0.30000000000000004, 'max_depth': 12.0, 'min_child_weight': 0.01, 'n_estimators': 83.28499016318806, 'subsample': 1.0}</td>
      <td>{'datetime': '2020-10-30 13:39:25', 'elapsed': 1.941584, 'delta': 0.31644}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.88</td>
      <td>{'gamma': 9.305856867266236, 'learning_rate': 0.22480207962183602, 'max_depth': 12.0, 'min_child_weight': 0.01, 'n_estimators': 86.83036935448472, 'subsample': 0.9074723165853541}</td>
      <td>{'datetime': '2020-10-30 13:39:25', 'elapsed': 1.625144, 'delta': 0.350861}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.88</td>
      <td>{'gamma': 13.480712774021772, 'learning_rate': 0.30000000000000004, 'max_depth': 7.7661648841523725, 'min_child_weight': 0.41259584117255604, 'n_estimators': 63.750800167428196, 'subsample': 0.9596783085054381}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 1.022118, 'delta': 0.347134}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.87</td>
      <td>{'ccp_alpha': 0.014799010765366001, 'max_depth': 42.142052245011904, 'min_samples_split': 41.8937045755086, 'n_estimators': 296.34970208953223}</td>
      <td>{'datetime': '2020-10-30 13:39:14', 'elapsed': 6.127783, 'delta': 0.960723}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.87</td>
      <td>{'gamma': 35.16617608102456, 'learning_rate': 0.21068284642408802, 'max_depth': 8.082502858171338, 'min_child_weight': 0.428190002137512, 'n_estimators': 98.51202283858542, 'subsample': 0.816357864745173}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.282294, 'delta': 0.14888099999999999}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.87</td>
      <td>{'ccp_alpha': 0.05102260093843201, 'max_depth': 86.02574921478518, 'min_samples_split': 48.07576337583058, 'n_estimators': 67.97509352312467}</td>
      <td>{'datetime': '2020-10-30 13:39:10', 'elapsed': 2.52469, 'delta': 0.33031000000000005}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.85</td>
      <td>{'gamma': 19.495778265726084, 'learning_rate': 0.266432273944672, 'max_depth': 4.729493626886408, 'min_child_weight': 0.544533263882786, 'n_estimators': 74.6260807963826, 'subsample': 0.358973913279641}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.6749839999999999, 'delta': 0.068507}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.56</td>
      <td>{'ccp_alpha': 0.044277730336006, 'max_depth': 30.40769038100241, 'min_samples_split': 55.903500612283615, 'n_estimators': 397.8693751566739}</td>
      <td>{'datetime': '2020-10-30 13:39:16', 'elapsed': 7.823453, 'delta': 1.204919}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.52</td>
      <td>{'gamma': 39.94569854033117, 'learning_rate': 0.15148062091928402, 'max_depth': 11.069378761474082, 'min_child_weight': 0.12093628496399302, 'n_estimators': 21.097429708742105, 'subsample': 0.46422971772563604}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.473572, 'delta': 0.032736999999999995}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.52</td>
      <td>{'gamma': 24.80241454968671, 'learning_rate': 0.056051507866554, 'max_depth': 6.400245283017297, 'min_child_weight': 0.151427556499518, 'n_estimators': 48.49371288449976, 'subsample': 0.165373633818094}</td>
      <td>{'datetime': '2020-10-30 13:39:24', 'elapsed': 0.6064769999999999, 'delta': 0.035761999999999995}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.52</td>
      <td>{'ccp_alpha': 0.012189417644428002, 'max_depth': 49.21498558471171, 'min_samples_split': 99.80545755782188, 'n_estimators': 494.1442418983624}</td>
      <td>{'datetime': '2020-10-30 13:39:12', 'elapsed': 4.119459, 'delta': 1.5947689999999999}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.52</td>
      <td>{'ccp_alpha': 0.077226623556453, 'max_depth': 63.20698907835343, 'min_samples_split': 59.186943965296464, 'n_estimators': 324.07583367083487}</td>
      <td>{'datetime': '2020-10-30 13:39:08', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>forest</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;bootstrap&#39;: True,
 &#39;ccp_alpha&#39;: 0.016125949599018908,
 &#39;class_weight&#39;: None,
 &#39;criterion&#39;: &#39;gini&#39;,
 &#39;max_depth&#39;: 85,
 &#39;max_features&#39;: &#39;auto&#39;,
 &#39;max_leaf_nodes&#39;: None,
 &#39;max_samples&#39;: None,
 &#39;min_impurity_decrease&#39;: 0.0,
 &#39;min_impurity_split&#39;: None,
 &#39;min_samples_leaf&#39;: 1,
 &#39;min_samples_split&#39;: 30,
 &#39;min_weight_fraction_leaf&#39;: 0.0,
 &#39;n_estimators&#39;: 116,
 &#39;n_jobs&#39;: -1,
 &#39;oob_score&#39;: False,
 &#39;random_state&#39;: None,
 &#39;verbose&#39;: 0,
 &#39;warm_start&#39;: False}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

