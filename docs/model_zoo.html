---

title: Iterate over classifiers with Bayesian optimization


keywords: fastai
sidebar: home_sidebar



nb_path: "04_model_zoo.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_model_zoo.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_data</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Synthetic binary classification dataset.&quot;&quot;&quot;</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">n_features</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span>


<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">_compile_results</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./bayes_opt_logs/&#39;</span><span class="p">))</span> <span class="c1"># &#39;./bayes_opt_logs/&#39; works fine as well.</span>
    <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Iterate-models">Iterate models<a class="anchor-link" href="#Iterate-models"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelIterator" class="doc_header"><code>class</code> <code>ModelIterator</code><a href="https://github.com/DavidykZhao/Yikai_helper_funcs/tree/master/Yikai_helper_funcs/model_iterator.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelIterator</code>(<strong><code>x</code></strong>, <strong><code>y</code></strong>, <strong><code>rf_params</code></strong>=<em><code>None</code></em>, <strong><code>xgboost_params</code></strong>=<em><code>None</code></em>, <strong><code>lightgbm_params</code></strong>=<em><code>None</code></em>, <strong><code>log_path</code></strong>=<em><code>Path('bayes_opt_logs')</code></em>, <strong><code>rf_init_points</code></strong>=<em><code>10</code></em>, <strong><code>rf_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>xgboost_init_points</code></strong>=<em><code>10</code></em>, <strong><code>xgboost_n_iter</code></strong>=<em><code>5</code></em>, <strong><code>lightgbm_init_points</code></strong>=<em><code>10</code></em>, <strong><code>lightgbm_n_iter</code></strong>=<em><code>5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span> <span class="o">=</span> <span class="n">ModelIterator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The best combination of hyperparameters are {&#39;ccp_alpha&#39;: 0.029834902375002192, &#39;max_depth&#39;: 35.69860577029296, &#39;min_samples_split&#39;: 4.497178477874517, &#39;n_estimators&#39;: 406.4077438886299}
The best score for the hyperparameters are 0.99
The best combination of hyperparameters are {&#39;gamma&#39;: 10.457964153104308, &#39;learning_rate&#39;: 0.27079083302557405, &#39;max_depth&#39;: 3.9195331071476, &#39;min_child_weight&#39;: 0.22851186079028146, &#39;n_estimators&#39;: 97.85382371807863, &#39;subsample&#39;: 0.5507585185908407}
The best score for the hyperparameters are 0.99

        ----------------------------------------------------
        Returned best_rf, best_xgboost
        
        
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RandomForestClassifier&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iterator</span><span class="o">.</span><span class="n">compile_results</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>params</th>
      <th>datetime</th>
      <th>model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.029834902375002, 'max_depth': 35.69860577029296, 'min_samples_split': 4.497178477874517, 'n_estimators': 406.4077438886299}</td>
      <td>{'datetime': '2020-10-30 12:15:31', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.049457167892975, 'max_depth': 21.34714460344915, 'min_samples_split': 2.097431305959691, 'n_estimators': 489.86987505735203}</td>
      <td>{'datetime': '2020-10-30 12:15:45', 'elapsed': 14.030575, 'delta': 2.085842}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.021861492413113002, 'max_depth': 83.05304497803968, 'min_samples_split': 20.243912858025652, 'n_estimators': 270.7014108189465}</td>
      <td>{'datetime': '2020-10-30 12:15:33', 'elapsed': 2.019139, 'delta': 0.823596}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.043781538376893005, 'max_depth': 62.67572775871829, 'min_samples_split': 46.88187614036777, 'n_estimators': 358.8362393777668}</td>
      <td>{'datetime': '2020-10-30 12:15:35', 'elapsed': 4.171425, 'delta': 1.260813}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.01, 'max_depth': 44.14258634567429, 'min_samples_split': 2.0, 'n_estimators': 360.63113095974927}</td>
      <td>{'datetime': '2020-10-30 12:15:40', 'elapsed': 8.294351, 'delta': 1.25263}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.1, 'max_depth': 105.0, 'min_samples_split': 25.40894051245977, 'n_estimators': 158.47752924077685}</td>
      <td>{'datetime': '2020-10-30 12:15:40', 'elapsed': 9.178861, 'delta': 0.88451}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.069757657642516, 'max_depth': 75.70271526835617, 'min_samples_split': 2.0, 'n_estimators': 389.6688850547288}</td>
      <td>{'datetime': '2020-10-30 12:15:42', 'elapsed': 10.656779, 'delta': 1.4779179999999998}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.99</td>
      <td>{'ccp_alpha': 0.1, 'max_depth': 105.0, 'min_samples_split': 2.0, 'n_estimators': 247.90684002652753}</td>
      <td>{'datetime': '2020-10-30 12:15:43', 'elapsed': 11.944733, 'delta': 1.287954}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.89</td>
      <td>{'gamma': 5.7300257335118445, 'learning_rate': 0.22360059477888103, 'max_depth': 3.8748947524170463, 'min_child_weight': 0.341132165498487, 'n_estimators': 86.43925887285536, 'subsample': 0.499383142077564}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 1.201651, 'delta': 0.12539799999999998}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.89</td>
      <td>{'ccp_alpha': 0.090029399554787, 'max_depth': 89.50191040914383, 'min_samples_split': 54.93897219851763, 'n_estimators': 160.88551700701495}</td>
      <td>{'datetime': '2020-10-30 12:15:38', 'elapsed': 7.041721, 'delta': 0.594742}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0.88</td>
      <td>{'gamma': 21.120544444663825, 'learning_rate': 0.22791705648514501, 'max_depth': 4.042679275107872, 'min_child_weight': 0.295275762314321, 'n_estimators': 58.5552736817226, 'subsample': 0.314009255628853}</td>
      <td>{'datetime': '2020-10-30 12:14:43', 'elapsed': 1.287337, 'delta': 0.085686}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.87</td>
      <td>{'gamma': 16.44338760251217, 'learning_rate': 0.05256451789020201, 'max_depth': 10.204316877141467, 'min_child_weight': 0.37087034414053205, 'n_estimators': 46.822120065426, 'subsample': 0.9300408535358081}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.708824, 'delta': 0.078763}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.87</td>
      <td>{'gamma': 5.438404255901645, 'learning_rate': 0.09912926135240001, 'max_depth': 10.875423657001221, 'min_child_weight': 0.29817664781213604, 'n_estimators': 16.20797044801588, 'subsample': 0.427833352953212}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.489853, 'delta': 0.029512999999999998}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.87</td>
      <td>{'gamma': 23.902685646619545, 'learning_rate': 0.140220199304396, 'max_depth': 10.427755231286966, 'min_child_weight': 0.190043303481046, 'n_estimators': 78.53806058006883, 'subsample': 0.9309827198629641}</td>
      <td>{'datetime': '2020-10-30 12:14:41', 'elapsed': 0.269099, 'delta': 0.14562899999999998}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0.87</td>
      <td>{'gamma': 8.242909356404795, 'learning_rate': 0.16402715204211002, 'max_depth': 4.102014314175854, 'min_child_weight': 0.254792568787706, 'n_estimators': 81.02980474091669, 'subsample': 0.582389761305676}</td>
      <td>{'datetime': '2020-10-30 12:14:43', 'elapsed': 1.418638, 'delta': 0.131301}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.85</td>
      <td>{'gamma': 12.065206351393131, 'learning_rate': 0.237563668878209, 'max_depth': 10.40085688904697, 'min_child_weight': 0.45836193440548206, 'n_estimators': 64.7779454870973, 'subsample': 0.690572316508353}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.46034, 'delta': 0.09467}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.85</td>
      <td>{'gamma': 26.845075131722044, 'learning_rate': 0.05637995945751, 'max_depth': 5.2311147200267865, 'min_child_weight': 0.38931716803493505, 'n_estimators': 99.60686866353187, 'subsample': 0.668658337550876}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.630061, 'delta': 0.140208}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.85</td>
      <td>{'gamma': 29.098063156312993, 'learning_rate': 0.132438457038936, 'max_depth': 6.760558963353372, 'min_child_weight': 0.20321910481126101, 'n_estimators': 89.52767108203464, 'subsample': 0.9907861999654861}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.866756, 'delta': 0.157932}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.85</td>
      <td>{'gamma': 35.40752339424799, 'learning_rate': 0.11638576576879502, 'max_depth': 11.946226616391376, 'min_child_weight': 0.21271170406467202, 'n_estimators': 22.473116195253535, 'subsample': 0.941746701654088}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.9163319999999999, 'delta': 0.049575999999999995}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0.84</td>
      <td>{'gamma': 12.008139725538545, 'learning_rate': 0.190519070111762, 'max_depth': 10.277996345197241, 'min_child_weight': 0.10229010266377, 'n_estimators': 64.2924671568606, 'subsample': 0.32337358470530403}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 1.076253, 'delta': 0.089782}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.82</td>
      <td>{'gamma': 21.349653589083115, 'learning_rate': 0.21358292424761802, 'max_depth': 9.566140475222866, 'min_child_weight': 0.528480038845596, 'n_estimators': 94.42886299055723, 'subsample': 0.391226481412892}</td>
      <td>{'datetime': '2020-10-30 12:14:41', 'elapsed': 0.12347000000000001, 'delta': 0.12347000000000001}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.82</td>
      <td>{'gamma': 28.70720798082302, 'learning_rate': 0.252551849877212, 'max_depth': 6.481601351187299, 'min_child_weight': 0.5701211390530441, 'n_estimators': 86.78484184655254, 'subsample': 0.44040453871295304}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.36567000000000005, 'delta': 0.09657099999999999}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.57</td>
      <td>{'gamma': 38.070990054984044, 'learning_rate': 0.28076336388418605, 'max_depth': 9.327504220779613, 'min_child_weight': 0.5628833420567271, 'n_estimators': 22.270791810081622, 'subsample': 0.604910459818371}</td>
      <td>{'datetime': '2020-10-30 12:14:42', 'elapsed': 0.986471, 'delta': 0.07013899999999999}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.51</td>
      <td>{'ccp_alpha': 0.040246899179255, 'max_depth': 49.92967821882293, 'min_samples_split': 57.113265209214546, 'n_estimators': 420.89718548783173}</td>
      <td>{'datetime': '2020-10-30 12:15:38', 'elapsed': 6.446979, 'delta': 1.372838}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.51</td>
      <td>{'ccp_alpha': 0.057339702313048004, 'max_depth': 25.554099877521686, 'min_samples_split': 69.38910049608978, 'n_estimators': 241.34776350907418}</td>
      <td>{'datetime': '2020-10-30 12:15:36', 'elapsed': 5.074141, 'delta': 0.902716}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.51</td>
      <td>{'ccp_alpha': 0.010163693535097001, 'max_depth': 75.53338720453232, 'min_samples_split': 85.32894324650903, 'n_estimators': 106.00648636175973}</td>
      <td>{'datetime': '2020-10-30 12:15:32', 'elapsed': 0.58179, 'delta': 0.41872499999999996}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.50</td>
      <td>{'gamma': 18.63749998555996, 'learning_rate': 0.13918876224437302, 'max_depth': 4.452858224882912, 'min_child_weight': 0.134993520008951, 'n_estimators': 55.72801664920143, 'subsample': 0.13589948304816402}</td>
      <td>{'datetime': '2020-10-30 12:14:41', 'elapsed': 0.0, 'delta': 0.0}</td>
      <td>xgboost</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.49</td>
      <td>{'ccp_alpha': 0.093135940132959, 'max_depth': 62.35607029188777, 'min_samples_split': 70.7404728288455, 'n_estimators': 35.040512564710355}</td>
      <td>{'datetime': '2020-10-30 12:15:31', 'elapsed': 0.163065, 'delta': 0.163065}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.49</td>
      <td>{'ccp_alpha': 0.032360585782017004, 'max_depth': 37.335790596710524, 'min_samples_split': 83.22619687861788, 'n_estimators': 282.22859485163144}</td>
      <td>{'datetime': '2020-10-30 12:15:34', 'elapsed': 2.910612, 'delta': 0.891473}</td>
      <td>forest</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.49</td>
      <td>{'ccp_alpha': 0.023023364312866, 'max_depth': 67.5729089671003, 'min_samples_split': 64.6490529306644, 'n_estimators': 170.31280438723786}</td>
      <td>{'datetime': '2020-10-30 12:15:32', 'elapsed': 1.195543, 'delta': 0.613753}</td>
      <td>forest</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;bootstrap&#39;: True,
 &#39;ccp_alpha&#39;: 0.029834902375002192,
 &#39;class_weight&#39;: None,
 &#39;criterion&#39;: &#39;gini&#39;,
 &#39;max_depth&#39;: 35,
 &#39;max_features&#39;: &#39;auto&#39;,
 &#39;max_leaf_nodes&#39;: None,
 &#39;max_samples&#39;: None,
 &#39;min_impurity_decrease&#39;: 0.0,
 &#39;min_impurity_split&#39;: None,
 &#39;min_samples_leaf&#39;: 1,
 &#39;min_samples_split&#39;: 4,
 &#39;min_weight_fraction_leaf&#39;: 0.0,
 &#39;n_estimators&#39;: 406,
 &#39;n_jobs&#39;: -1,
 &#39;oob_score&#39;: False,
 &#39;random_state&#39;: None,
 &#39;verbose&#39;: 0,
 &#39;warm_start&#39;: False}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

